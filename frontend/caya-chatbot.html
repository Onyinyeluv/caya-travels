<!-- Caya.ai Chatbot Widget -->
<style>
  /* Chatbot Styles */
  .caya-chatbot-container {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 10000;
    font-family: 'Inter', sans-serif;
  }

  .caya-chat-button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #D4AF37 0%, #c49b2c 100%);
    border: none;
    box-shadow: 0 4px 20px rgba(212, 175, 55, 0.4);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    position: relative;
  }

  .caya-chat-button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 25px rgba(212, 175, 55, 0.6);
  }

  .caya-chat-button img {
    width: 35px;
    height: 35px;
    border-radius: 50%;
  }

  .caya-chat-button .chat-icon {
    font-size: 28px;
  }

  .caya-chat-pulse {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: rgba(212, 175, 55, 0.4);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0; }
  }

  .caya-chatbox {
    position: fixed;
    bottom: 100px;
    right: 30px;
    width: 380px;
    height: 550px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    display: none;
    flex-direction: column;
    overflow: hidden;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .caya-chatbox.active {
    display: flex;
  }

  .caya-chat-header {
    background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
    color: white;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .caya-chat-header-info {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .caya-chat-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .caya-chat-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 700;
  }

  .caya-chat-status {
    font-size: 12px;
    opacity: 0.9;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    background: #4ade80;
    border-radius: 50%;
    animation: blink 2s infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .caya-close-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .caya-chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #f9fafb;
  }

  .caya-message {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .caya-message.bot {
    flex-direction: row;
  }

  .caya-message.user {
    flex-direction: row-reverse;
  }

  .message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #D4AF37 0%, #c49b2c 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
  }

  .message-avatar.user-avatar {
    background: #1a237e;
  }

  .message-content {
    max-width: 75%;
    padding: 12px 16px;
    border-radius: 18px;
    line-height: 1.5;
    font-size: 14px;
  }

  .caya-message.bot .message-content {
    background: white;
    color: #1f2937;
    border-bottom-left-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .caya-message.user .message-content {
    background: #1a237e;
    color: white;
    border-bottom-right-radius: 4px;
  }

  .caya-typing-indicator {
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: white;
    border-radius: 18px;
    width: fit-content;
  }

  .typing-dot {
    width: 8px;
    height: 8px;
    background: #9ca3af;
    border-radius: 50%;
    animation: typingBounce 1.4s infinite;
  }

  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes typingBounce {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-10px); }
  }

  .caya-chat-input-area {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e5e7eb;
  }

  .caya-quick-options {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
    overflow-x: auto;
    padding-bottom: 5px;
  }

  .caya-quick-options::-webkit-scrollbar {
    height: 4px;
  }

  .caya-quick-options::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 4px;
  }

  .quick-option-btn {
    padding: 6px 12px;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    border-radius: 20px;
    font-size: 12px;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
  }

  .quick-option-btn:hover {
    background: #D4AF37;
    color: white;
    border-color: #D4AF37;
  }

  .caya-input-wrapper {
    display: flex;
    gap: 10px;
  }

  .caya-chat-input {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 25px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.3s;
  }

  .caya-chat-input:focus {
    border-color: #D4AF37;
  }

  .caya-send-btn {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #D4AF37 0%, #c49b2c 100%);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
  }

  .caya-send-btn:hover {
    transform: scale(1.1);
  }

  .caya-send-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .caya-chatbox {
      width: calc(100vw - 20px);
      height: calc(100vh - 120px);
      right: 10px;
      bottom: 90px;
    }

    .caya-chat-button {
      width: 55px;
      height: 55px;
      bottom: 20px;
      right: 20px;
    }
  }
</style>

<!-- Chatbot HTML -->
<div class="caya-chatbot-container">
  <!-- Chat Button -->
  <button class="caya-chat-button" id="cayaChatButton" onclick="toggleCayaChat()">
    <div class="caya-chat-pulse"></div>
    <span class="chat-icon">ðŸ¤–</span>
  </button>

  <!-- Chatbox -->
  <div class="caya-chatbox" id="cayaChatbox">
    <!-- Header -->
    <div class="caya-chat-header">
      <div class="caya-chat-header-info">
        <div class="caya-chat-avatar">ðŸ¤–</div>
        <div>
          <h3>Caya.ai</h3>
          <div class="caya-chat-status">
            <span class="status-dot"></span>
            <span>Online</span>
          </div>
        </div>
      </div>
      <button class="caya-close-btn" onclick="toggleCayaChat()">Ã—</button>
    </div>

    <!-- Messages Area -->
    <div class="caya-chat-messages" id="cayaChatMessages">
      <!-- Messages will be inserted here -->
    </div>

    <!-- Input Area -->
    <div class="caya-chat-input-area">
      <div class="caya-quick-options" id="cayaQuickOptions">
        <button class="quick-option-btn" onclick="sendQuickMessage('What is a transit visa?')">Transit Visa</button>
        <button class="quick-option-btn" onclick="sendQuickMessage('Study in Canada')">Study Abroad</button>
        <button class="quick-option-btn" onclick="sendQuickMessage('Book flight to Dubai')">Book Flights</button>
        <button class="quick-option-btn" onclick="sendQuickMessage('Tour packages')">Tour Packages</button>
        <button class="quick-option-btn" onclick="sendQuickMessage('Contact details')">Contact Us</button>
      </div>
      <div class="caya-input-wrapper">
        <input 
          type="text" 
          class="caya-chat-input" 
          id="cayaChatInput" 
          placeholder="Ask me anything..."
          onkeypress="if(event.key==='Enter') sendCayaMessage()"
        >
        <button class="caya-send-btn" onclick="sendCayaMessage()">
          <span>âž¤</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script src="caya-ai.js"></script>
<script>
  // Chatbot Functionality
  let chatHistory = [];

  function toggleCayaChat() {
    const chatbox = document.getElementById('cayaChatbox');
    chatbox.classList.toggle('active');
    
    // Show welcome message on first open
    if (chatbox.classList.contains('active') && chatHistory.length === 0) {
      setTimeout(() => {
        addBotMessage(cayaAI.generateResponse('').response);
      }, 500);
    }
  }

  function addBotMessage(message) {
    const messagesContainer = document.getElementById('cayaChatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'caya-message bot';
    messageDiv.innerHTML = `
      <div class="message-avatar">ðŸ¤–</div>
      <div class="message-content">${formatMessage(message)}</div>
    `;
    messagesContainer.appendChild(messageDiv);
    scrollToBottom();
  }

  function addUserMessage(message) {
    const messagesContainer = document.getElementById('cayaChatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'caya-message user';
    messageDiv.innerHTML = `
      <div class="message-avatar user-avatar">ðŸ‘¤</div>
      <div class="message-content">${message}</div>
    `;
    messagesContainer.appendChild(messageDiv);
    scrollToBottom();
  }

  function showTypingIndicator() {
    const messagesContainer = document.getElementById('cayaChatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'caya-message bot';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
      <div class="message-avatar">ðŸ¤–</div>
      <div class="caya-typing-indicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    `;
    messagesContainer.appendChild(typingDiv);
    scrollToBottom();
  }

  function removeTypingIndicator() {
    const indicator = document.getElementById('typingIndicator');
    if (indicator) {
      indicator.remove();
    }
  }

  function formatMessage(message) {
    // Convert markdown-style formatting to HTML
    let formatted = message
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\n/g, '<br>')
      .replace(/â€¢ /g, '&nbsp;&nbsp;â€¢ ')
      .replace(/âœ“ /g, '&nbsp;&nbsp;âœ“ ')
      .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" style="color: #D4AF37;">$1</a>');
    
    return formatted;
  }

  function sendCayaMessage() {
    const input = document.getElementById('cayaChatInput');
    const message = input.value.trim();
    
    if (message === '') return;
    
    // Add user message
    addUserMessage(message);
    chatHistory.push({ type: 'user', message });
    
    // Clear input
    input.value = '';
    
    // Show typing indicator
    showTypingIndicator();
    
    // Simulate AI thinking time and generate response
    setTimeout(() => {
      removeTypingIndicator();
      const aiResponse = cayaAI.generateResponse(message);
      addBotMessage(aiResponse.response);
      chatHistory.push({ type: 'bot', message: aiResponse.response });
    }, 1000 + Math.random() * 1000);
  }

  function sendQuickMessage(message) {
    document.getElementById('cayaChatInput').value = message;
    sendCayaMessage();
  }

  function scrollToBottom() {
    const messagesContainer = document.getElementById('cayaChatMessages');
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  // Auto-open chat after 5 seconds (optional)
  setTimeout(() => {
    if (!document.getElementById('cayaChatbox').classList.contains('active')) {
      // Show a small notification
      const button = document.getElementById('cayaChatButton');
      button.style.animation = 'pulse 1s ease 3';
    }
  }, 5000);
</script>
